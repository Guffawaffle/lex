{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "LexBehaviorRule",
  "description": "Canonical schema for LexSona behavioral memory rules (CptPlnt v1.0)",
  "type": "object",
  "properties": {
    "rule_id": {
      "type": "string",
      "description": "Stable identifier independent of phrasing (e.g., 'tool.no-sed-for-file-editing')"
    },
    "category": {
      "type": "string",
      "description": "Grouping for downstream consumers (e.g., 'tool_preference', 'communication_style', 'security_policy')"
    },
    "text": {
      "type": "string",
      "description": "Human-readable rule statement"
    },
    "scope": {
      "type": "object",
      "description": "Context where this rule applies",
      "properties": {
        "environment": {
          "type": "string",
          "description": "e.g., 'awa', 'personal', 'sandbox'"
        },
        "project": {
          "type": "string",
          "description": "e.g., 'awa-monorepo', 'lex-core'"
        },
        "agent_family": {
          "type": "string",
          "description": "e.g., 'gpt', 'claude', 'copilot'"
        },
        "context_tags": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "description": "e.g., ['php', 'cli', 'security']"
        }
      },
      "additionalProperties": false
    },
    "alpha": {
      "type": "integer",
      "minimum": 2,
      "default": 2,
      "description": "Bayesian Beta prior parameter (reinforcements + prior). Default skeptical prior alpha_0=2."
    },
    "beta": {
      "type": "integer",
      "minimum": 5,
      "default": 5,
      "description": "Bayesian Beta prior parameter (counterexamples + prior). Default skeptical prior beta_0=5."
    },
    "reinforcements": {
      "type": "integer",
      "minimum": 0,
      "description": "Count of user corrections reinforcing this rule (informational, redundant with alpha-alpha_0)"
    },
    "counter_examples": {
      "type": "integer",
      "minimum": 0,
      "description": "Count of user exceptions contradicting this rule (informational, redundant with beta-beta_0)"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "DERIVED FIELD: alpha / (alpha + beta). Not primary storage. Recompute on query."
    },
    "severity": {
      "type": "string",
      "enum": [
        "must",
        "should",
        "style"
      ],
      "description": "Precedence level: 'must' = hard constraint, 'should' = strong preference, 'style' = soft convention"
    },
    "first_seen": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp when rule was first created"
    },
    "last_correction": {
      "type": "string",
      "format": "date-time",
      "description": "ISO 8601 timestamp of most recent reinforcement or counterexample"
    },
    "frame_id": {
      "type": "string",
      "description": "Optional: Link to Lex Frame for auditability. Required in Lex ecosystem, optional in standalone deployments."
    }
  },
  "required": [
    "rule_id",
    "category",
    "text",
    "scope",
    "alpha",
    "beta",
    "severity",
    "first_seen",
    "last_correction"
  ],
  "additionalProperties": false
}
