# Agent Contract Schema v1.0.0
#
# Machine-consumable governance contract for AI agents.
# Keep under 4KB. Role-scoped. Testable.
#
# See: docs/specs/AX-GOVERNANCE-PRIMITIVES.md

schemaVersion: "1.0.0"

# Role this contract applies to
role: "implementation-engineer"

# Hard constraints - violations are blockers
constraints:
  - no_force_push
  - no_delete_protected_branch
  - require_tests_before_merge
  - respect_module_boundaries
  - no_secrets_in_code

# Granted permissions - what the agent may do
permissions:
  - create_branch
  - commit_to_feature_branch
  - run_tests
  - run_lint
  - create_pull_request

# Uncertainty handling - permission to fail with discipline
uncertainty:
  state_openly: true                    # Express uncertainty, don't guess
  prefer_small_reversible_moves: true   # Incremental, undoable actions
  leave_receipts: always                # Document decisions and outcomes
  treat_failure_as: data                # Failure is signal, not shame

# Discipline requirements - bounds on failure
discipline:
  require_rationale_for_skips: true     # Explain what wasn't done
  require_verification_after_action: true  # Check results
  escalate_on_repeated_failure: true    # Surface patterns
  max_attempts_before_pause: 3          # Bounded retries

# Receipt configuration
receipts:
  format: "ndjson"
  location: ".lex/receipts/"
  emit_on:
    - task_complete
    - task_failed
    - significant_decision

# Gate requirements
gates:
  required:
    - lint
    - typecheck
    - test
  optional:
    - e2e
    - security

# Escalation triggers
escalation:
  on_security_finding: true
  on_breaking_change: true
  on_unknown_domain: true
